<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LvRouter 路由信息生命体</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
  <header>
    <h1>LvRouter 路由信息生命体 · 总览图谱</h1>
    <div class="search-row">
      <input id="search" type="text" placeholder="搜索概念/规则/模块关键词" />
      <button id="clear-search" type="button">清空</button>
    </div>
  </header>

  <main>
    <section id="graph-panel">
      <svg id="graph" aria-label="路由图谱"></svg>
    </section>
    <aside id="sidebar">
      <h2 id="sidebar-title">请选择图谱节点</h2>
      <div id="sidebar-summary" class="meta">搜索或点击节点查看细节。</div>
      <div id="sidebar-entry" class="meta"></div>
      <div id="sidebar-links"></div>
      <hr />
      <p class="meta">提示：若浏览器拦截弹窗，请允许本站点打开新页面。</p>
    </aside>
  </main>

  <script>
    window.GRAPH_FALLBACK = {
      "nodes": [
        {
          "id": "big_picture",
          "label": "全局总览",
          "slug": "big-picture",
          "summary": "入口/模块/术语全景（已定位主入口与核心模块）",
          "entry": "cmd/router/main.go:1-6 → internal/app/app.go:28-119 (Run)",
          "md": "../md/01_big_picture.md",
          "tags": ["MECE", "总览", "入口"]
        },
        {
          "id": "request_flow",
          "label": "请求流程",
          "slug": "request-flow",
          "summary": "TokenAuth → Distribute → Relay → Adaptor → 响应",
          "entry": "internal/transport/http/router/relay.go:20-22; api.go:113-115",
          "md": "../md/02_request_flow.md",
          "tags": ["流程", "入站", "转发"]
        },
        {
          "id": "routing_rules",
          "label": "路由规则",
          "slug": "routing-rules",
          "summary": "分组+模型选渠、优先级随机、失败重试降级",
          "entry": "middleware/distributor.go:20-111; model/cache.go:228-255; admin/controller/relay.go:70-97",
          "md": "../md/03_routing_rules.md",
          "tags": ["选择", "回退", "重试"]
        },
        {
          "id": "provider_forward",
          "label": "上游转发",
          "slug": "provider-forward",
          "summary": "Adaptor 转换请求并使用 HTTPClient 发送",
          "entry": "relay/controller/text.go:25-86; relay/adaptor/common.go:22-52",
          "md": "../md/04_provider_forward.md",
          "tags": ["转发", "协议", "超时"]
        },
        {
          "id": "key_acl_quota",
          "label": "Key/权限/额度",
          "slug": "key-acl-quota",
          "summary": "JWT/UCAN/sk 选择顺序 + subnet/models 限制 + 预扣/后扣",
          "entry": "middleware/auth.go:155-352; relay/controller/helper.go:68-160",
          "md": "../md/05_key_acl_quota.md",
          "tags": ["key", "ACL", "Quota"]
        },
        {
          "id": "health_failover",
          "label": "健康探测/回退",
          "slug": "healthcheck-failover",
          "summary": "错误触发禁用 + 指标熔断 + 定时测试",
          "entry": "admin/controller/relay.go:130-137; admin/monitor/manage.go:11-43; channel/test.go:230-323",
          "md": "../md/06_healthcheck_failover.md",
          "tags": ["健康", "熔断", "回退"]
        },
        {
          "id": "config_surface",
          "label": "配置面",
          "slug": "config-surface",
          "summary": "RetryTimes/RelayTimeout/Metric/CORS/测试频率等",
          "entry": "common/config/config.go:104-180; middleware/cors.go:13-62",
          "md": "../md/07_config_surface.md",
          "tags": ["配置", "环境变量"]
        }
      ],
      "edges": [
        { "from": "big_picture", "to": "request_flow", "label": "概览→流程" },
        { "from": "request_flow", "to": "routing_rules", "label": "流程→路由" },
        { "from": "routing_rules", "to": "provider_forward", "label": "路由→转发" },
        { "from": "routing_rules", "to": "key_acl_quota", "label": "路由→权限" },
        { "from": "routing_rules", "to": "health_failover", "label": "路由→健康" },
        { "from": "request_flow", "to": "config_surface", "label": "流程→配置" }
      ]
    };
  </script>
  <script src="assets/app.js"></script>
</body>
</html>
